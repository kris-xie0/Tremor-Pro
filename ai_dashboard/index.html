<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TremorSense AI â€” Clinical Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="AI-powered clinical tremor analysis dashboard â€” ESP32 real-time data with MedGemma 4B reasoning.">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

  <!-- GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

  <!-- Custom styles -->
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>

<!-- Ambient orbs -->
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<!-- â•â•â• HEADER â•â•â• -->
<header id="app-header">

  <!-- Logo -->
  <div class="logo-wrap">
    <div class="logo-icon">ðŸ§ </div>
    <div class="logo-text">
      <div class="logo-title">TremorSense AI</div>
      <div class="logo-sub">Clinical Reasoning Â· MedGemma 4B</div>
    </div>
  </div>

  <!-- IP input (center) -->
  <div class="header-center">
    <svg width="14" height="14" fill="none" stroke="#6366f1" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><circle cx="12" cy="20" r="1" fill="#6366f1" stroke="none"/></svg>
    <input type="text" id="espIP" value="192.168.4.1" placeholder="ESP32 IP address" spellcheck="false" autocomplete="off">
  </div>

  <!-- Status + connect -->
  <div class="header-right">
    <div id="statusPill" class="status-pill disconnected">
      <span class="dot"></span>
      <span id="statusText">Disconnected</span>
    </div>
    <button id="btnConnect" class="btn btn-connect" onclick="connectESP()">
      <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><circle cx="12" cy="20" r="1" fill="currentColor" stroke="none"/></svg>
      Connect
    </button>
  </div>
</header>

<!-- â•â•â• TOOLBAR â•â•â• -->
<div id="toolbar">
  <button id="btnStart" class="btn btn-start" onclick="startSession()" disabled>
    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg>
    Start Session
  </button>
  <button id="btnStop" class="btn btn-stop" onclick="stopSession()" disabled>
    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
    Stop Session
  </button>

  <div class="toolbar-sep"></div>

  <div class="session-meta">
    Windows&nbsp;<strong id="windowCount">0</strong>
    &nbsp;Â·&nbsp;
    Duration&nbsp;<strong id="sessionDur">0s</strong>
  </div>

  <button id="btnAnalyze" class="btn btn-ai" onclick="generateReport()" disabled>
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10"/><path d="M12 8v4l3 3"/></svg>
    Generate AI Report
  </button>
</div>

<!-- â•â•â• MAIN GRID â•â•â• -->
<div id="main-grid">

  <!-- â”€â”€â”€ LEFT COLUMN â”€â”€â”€ -->
  <div>

    <!-- â”€â”€ Live Stats row â”€â”€ -->
    <div class="card fade-in">
      <div class="card-header">
        <div class="card-title">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          Live Session Stats
        </div>
        <div style="font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace">
          50 Hz sampling
        </div>
      </div>

      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-label">Tremor Score</div>
          <div class="stat-value c-cyan" id="liveScore">â€”</div>
          <div class="stat-unit">/ 10</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Session Avg</div>
          <div class="stat-value c-green" id="liveAvg">â€”</div>
          <div class="stat-unit">mean</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Peak</div>
          <div class="stat-value c-red" id="livePeak">â€”</div>
          <div class="stat-unit">max</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Classification</div>
          <div class="stat-value c-yellow" id="liveClass" style="font-size:15px;margin-top:8px">â€”</div>
          <div class="stat-unit">&nbsp;</div>
        </div>
      </div>

      <!-- Live waveform -->
      <div class="chart-wrap">
        <canvas id="waveCanvas"></canvas>
        <div class="chart-overlay">
          SCORE&nbsp;<span id="chartScore" style="color:rgba(255,255,255,.55)">â€”</span>
        </div>
      </div>

      <!-- Band power bars -->
      <div class="card-title" style="margin-bottom:12px">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="4" height="20" rx="1"/><rect x="10" y="6" width="4" height="16" rx="1"/><rect x="18" y="10" width="4" height="12" rx="1"/></svg>
        Frequency Band Power
      </div>
      <div class="bands-grid">
        <div class="band-row">
          <div class="band-label">4â€“6 Hz</div>
          <div class="band-track"><div class="band-fill b1" id="bar1" style="width:0%"></div></div>
          <div class="band-pct" id="pct1">0%</div>
        </div>
        <div class="band-row">
          <div class="band-label">6â€“8 Hz</div>
          <div class="band-track"><div class="band-fill b2" id="bar2" style="width:0%"></div></div>
          <div class="band-pct" id="pct2">0%</div>
        </div>
        <div class="band-row">
          <div class="band-label">8â€“12 Hz</div>
          <div class="band-track"><div class="band-fill b3" id="bar3" style="width:0%"></div></div>
          <div class="band-pct" id="pct3">0%</div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Session Summary â”€â”€ -->
    <div class="card fade-in">
      <div class="card-header">
        <div class="card-title">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          Session Summary
        </div>
      </div>

      <div class="stats-row" style="grid-template-columns:repeat(3,1fr);margin-bottom:12px">
        <div class="stat-card">
          <div class="stat-label">Mean Score</div>
          <div class="stat-value" id="sumMean" style="font-size:19px">â€”</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Std Dev</div>
          <div class="stat-value" id="sumStd" style="font-size:19px">â€”</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Dominant Band</div>
          <div class="stat-value" id="sumDom" style="font-size:14px;margin-top:8px">â€”</div>
        </div>
      </div>

      <!-- Distribution -->
      <div class="card-title" style="margin-bottom:10px">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg>
        Intensity Distribution
      </div>
      <div class="dist-row">
        <div class="dist-card">
          <div class="dist-label">Low</div>
          <div class="dist-val" style="color:var(--green)" id="distLow">â€”</div>
        </div>
        <div class="dist-card">
          <div class="dist-label">Moderate</div>
          <div class="dist-val" style="color:var(--yellow)" id="distMod">â€”</div>
        </div>
        <div class="dist-card">
          <div class="dist-label">High</div>
          <div class="dist-val" style="color:var(--orange)" id="distHigh">â€”</div>
        </div>
        <div class="dist-card">
          <div class="dist-label">Very High</div>
          <div class="dist-val" style="color:var(--red)" id="distVHigh">â€”</div>
        </div>
      </div>

      <!-- Trend sparkline -->
      <div class="trend-wrap">
        <div class="trend-label">Within-session trend</div>
        <div class="trend-chart-wrap">
          <canvas id="trendCanvas"></canvas>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Event Log â”€â”€ -->
    <div class="card fade-in">
      <div class="card-header">
        <div class="card-title">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          Event Log
        </div>
        <button class="btn btn-ghost" style="padding:4px 10px;font-size:11px" onclick="document.getElementById('eventLog').innerHTML=''">Clear</button>
      </div>
      <pre class="event-log" id="eventLog"></pre>
    </div>
  </div>

  <!-- â”€â”€â”€ RIGHT COLUMN: AI Report â”€â”€â”€ -->
  <div>
    <div class="ai-card fade-in" style="position:sticky;top:84px">
      <div class="ai-card-inner">

        <div class="ai-header">
          <div class="ai-icon-wrap">ðŸ§ </div>
          <div>
            <div class="ai-title">AI Clinical Report</div>
            <div class="ai-sub">MedGemma 4B Â· Tremor Analysis</div>
          </div>
          <div style="position:relative;margin-left:auto" class="tooltip-host">
            <div style="width:8px;height:8px;border-radius:50%;background:rgba(99,102,241,.5);margin-top:2px"></div>
            <div class="rec-ring"></div>
            <div class="tooltip-box">Recording active</div>
          </div>
        </div>

        <!-- Placeholder -->
        <div class="ai-placeholder-wrap" id="aiPlaceholder">
          <div class="ai-placeholder-ring">ðŸ”¬</div>
          <div class="ai-placeholder-text">
            Connect to TremorSense, start a recording session, accumulate data windows, then click
            <strong style="color:#a78bfa">Generate AI Report</strong> for a full clinical analysis.
          </div>

          <!-- Steps -->
          <div style="display:flex;flex-direction:column;gap:8px;width:100%;margin-top:8px">
            <div style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--surface2);border-radius:9px;border:1px solid var(--border);font-size:12px;color:var(--muted)">
              <span style="width:20px;height:20px;border-radius:6px;background:rgba(99,102,241,.2);display:flex;align-items:center;justify-content:center;font-size:11px;color:#818cf8;font-weight:700;flex-shrink:0">1</span>
              Enter ESP32 IP and Connect
            </div>
            <div style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--surface2);border-radius:9px;border:1px solid var(--border);font-size:12px;color:var(--muted)">
              <span style="width:20px;height:20px;border-radius:6px;background:rgba(16,185,129,.15);display:flex;align-items:center;justify-content:center;font-size:11px;color:#34d399;font-weight:700;flex-shrink:0">2</span>
              Start Session â†’ Stop Session
            </div>
            <div style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--surface2);border-radius:9px;border:1px solid var(--border);font-size:12px;color:var(--muted)">
              <span style="width:20px;height:20px;border-radius:6px;background:rgba(139,92,246,.2);display:flex;align-items:center;justify-content:center;font-size:11px;color:#a78bfa;font-weight:700;flex-shrink:0">3</span>
              Click Generate AI Report
            </div>
          </div>
        </div>

        <!-- Result -->
        <div id="aiResult" style="display:none;flex-direction:column;gap:14px">
          <div class="ai-content" id="aiContent"></div>
          <div id="aiConfidence"></div>
          <div class="ai-advisory-box" id="aiAdvisory"></div>
        </div>

      </div>
    </div>
  </div>

</div>

<!-- Scripts -->
<script src="dashboard.js"></script>
</body>
</html>